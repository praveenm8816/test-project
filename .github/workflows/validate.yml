name: PR Validation

on:
  pull_request:
    branches: [ "develop" ]

jobs:
  encoding-check:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install chardet  # Only install what your script needs

      - name: Get changed files
        id: changed-files
        run: |
          git fetch origin develop
          git diff --name-status origin/develop...HEAD > changed_files.txt
          echo "CHANGED_FILES=$(awk '{print $2}' changed_files.txt | paste -sd ',' -)" >> $GITHUB_ENV

      - name: Run encoding, naming, and location checks
        run: |
          echo "$CHANGED_FILES" | tr ',' '\n' > changed_file_list.txt
          FILES=$(awk '/\.(sql|txt|csv|pkb)$/' changed_file_list.txt || true)
          if [ -z "$FILES" ]; then
            echo "No relevant files to check."
            exit 0
          fi
          python3 .github/check_encoding.py $FILES
